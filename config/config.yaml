# Telescope Detection System Configuration

camera:
  ip: "10.0.8.18"
  username: "admin"
  password: "5326jbbD"
  stream: "main"  # Options: "main" (2K) or "sub" (lower resolution)

  # Frame processing
  target_width: 1280
  target_height: 720
  buffer_size: 1  # Keep at 1 for lowest latency

detection:
  # GroundingDINO Model configuration (Apache 2.0 license)
  model:
    config: "models/GroundingDINO_SwinT_OGC.py"
    weights: "models/groundingdino_swint_ogc.pth"
  device: "cuda:0"

  # Open-vocabulary text prompts for GroundingDINO
  # Comprehensive desert Southwest wildlife + human detection
  text_prompts:
    # Humans and pets
    - "person"
    - "dog"
    - "cat"

    # Desert mammals (predators)
    - "coyote"
    - "bobcat"
    - "fox"
    - "mountain lion"
    - "puma"
    - "skunk"
    - "raccoon"

    # Desert mammals (prey/herbivores)
    - "rabbit"
    - "cottontail"
    - "jackrabbit"
    - "ground squirrel"
    - "pack rat"
    - "kangaroo rat"
    - "mouse"
    - "deer"
    - "mule deer"
    - "javelina"
    - "peccary"

    # Birds (raptors)
    - "hawk"
    - "red-tailed hawk"
    - "owl"
    - "great horned owl"
    - "barn owl"
    - "falcon"
    - "kestrel"
    - "vulture"
    - "turkey vulture"
    - "eagle"

    # Birds (ground dwellers)
    - "roadrunner"
    - "quail"
    - "gambel's quail"

    # Birds (common)
    - "raven"
    - "crow"
    - "dove"
    - "mourning dove"
    - "hummingbird"
    - "sparrow"
    - "finch"
    - "jay"
    - "woodpecker"
    - "thrush"
    - "mockingbird"
    - "cardinal"
    - "oriole"

    # Reptiles (lizards)
    - "lizard"
    - "desert lizard"
    - "small lizard"
    - "iguana"
    - "desert iguana"
    - "chuckwalla"
    - "collared lizard"
    - "horned lizard"
    - "gecko"
    - "zebra-tailed lizard"

    # Reptiles (snakes and tortoises)
    - "snake"
    - "rattlesnake"
    - "gopher snake"
    - "king snake"
    - "tortoise"
    - "desert tortoise"

    # Amphibians
    - "toad"
    - "frog"

    # Arthropods (if visible at distance)
    - "scorpion"
    - "tarantula"

    # General categories (fallback)
    - "reptile"
    - "bird"
    - "mammal"
    - "small animal"

  # Two-stage detection pipeline (GroundingDINO + iNaturalist)
  use_two_stage: false  # Feature currently disabled
  enable_species_classification: false  # Feature currently disabled

  # GroundingDINO thresholds
  box_threshold: 0.25  # Confidence for bounding boxes (similar to old confidence)
  text_threshold: 0.25  # Confidence for text-image matching

  # Per-class confidence overrides (higher threshold = fewer false positives)
  class_confidence_overrides:
    person: 0.60  # Much higher to reduce false "person" detections

  # Size filtering (better than just confidence for distant wildlife!)
  # Note: Inference runs at 1280x720 (921,600 total pixels)
  # Typical sizes: tiny=50-200px², small bird/rabbit=200-1000px², coyote=1000-5000px²
  min_box_area: 50  # Minimum bounding box area in pixels² (~7x7 pixels) - catches small lizards
  max_detections: 300  # Maximum number of detections per frame

# Stage 2 Species Classification (fine-grained identification)
species_classification:
  enabled: true
  confidence_threshold: 0.3  # Minimum confidence for species ID

  # Universal iNaturalist model (covers 10,000 species)
  inat_classifier:
    model_name: "timm/eva02_large_patch14_clip_336.merged2b_ft_inat21"
    taxonomy_file: "models/inat2021_taxonomy_simple.json"
    input_size: 336  # EVA02 uses 336x336 input
    confidence_threshold: 0.3

web:
  host: "0.0.0.0"
  port: 8000

performance:
  # Queue sizes
  frame_queue_size: 2
  detection_queue_size: 10

  # Detection history
  history_size: 30

# Future configuration for Phase 3
detection_zones: []
  # Example:
  # - name: "telescope_danger_zone"
  #   type: "polygon"
  #   points: [[100,200], [300,200], [300,400], [100,400]]
  #   alert_on_entry: ["person"]

collision_detection:
  enabled: false
  danger_threshold: 50  # pixels

# Snapshot/Clip Saving
snapshots:
  enabled: true  # Enable snapshot saving
  save_mode: "image"  # "image" for single frames, "clip" for videos
  output_dir: "clips"  # Directory to save snapshots

  # Trigger settings
  trigger_classes:  # Classes that trigger saves (empty = all detections)
    - "person"
    - "cat"      # might catch: iguanas, large lizards
    - "dog"      # might catch: coyotes
    - "bird"     # will catch: roadrunner, quail, all birds
    # Wildlife-adjacent that might be relevant:
    - "bear"
    - "horse"
    - "sheep"
    - "cow"
    # Note: bananas, chairs, potted plants, etc. will still DISPLAY but won't save snapshots!
  min_confidence: 0.30  # Lower for distant/small wildlife from high camera mount
  cooldown_seconds: 45  # Seconds between saves for same class
  save_annotated: true  # Save with bounding boxes drawn

  # Video clip settings (only used if save_mode="clip")
  clip_duration: 10  # Total clip duration in seconds
  pre_buffer_seconds: 5  # Seconds of video before detection
  fps: 30  # Frames per second for video clips
